@using System.Globalization
@using System.Web
@model Votor.Areas.Voting.Controllers.QuestionChartModel

@{
    var chartId = Guid.NewGuid();
}

@if (Model != null)
{
    <div class="card">
        <div class="card-content">
            <p class="card-title">@Model.Question</p>
            <div id="@chartId" style="width: 100%; min-height: 300px;"></div>
        </div>
    </div>
    

    <script type="text/javascript">
        var chart = echarts.init(document.getElementById("@chartId"));

        var data = initData();

        if (chart) {

            var options = {
                tooltip: {
                    trigger: "item",
                    formatter: "{a} <br />{b} : {c} ({d}%)"
                },
                legend: {
                    data: ["@Localizer["Votes"]", "@Localizer["Weighted Votes"]"]
                },
                xAxis: {
                    type: "category",
                    data: data.xAxis
                },
                yAxis: {
                    type: "value"
                },
                series: [
                    {
                        name: "@Localizer["Votes"]",
                        type: "bar",
                        barGap: "5%",
                        barWidth:"20%",
                        data: data.series,
                        color: "#7b1fa2"
                    },
                    {
                        name: "@Localizer["Weighted Votes"]",
                        type: "bar",
                        barGap: "5%",
                        barWidth: "20%",
                        data: data.seriesWeighted,
                        color: "#00acc1"
                    }
                ]
            };

            chart.setOption(options);

            window.votorCharts.push(chart);
        }

        function initData() {
            var data = {};
            data.xAxis = [];
            data.series = [];
            data.seriesWeighted = [];

            @foreach (var value in Model.Values) {
                <text>
                    data.xAxis.push("@Html.Raw(HttpUtility.JavaScriptStringEncode(value.Name))");
                    data.series.push({
                        name: "@Html.Raw(HttpUtility.JavaScriptStringEncode(value.Name))",
                        value: @value.Value
                    });
                </text>
            }

            @foreach (var value in Model.WeightedValues)
            {
                <text>
                    data.seriesWeighted.push({
                        name: "@Html.Raw(HttpUtility.JavaScriptStringEncode(value.Name))",
                        value: @value.Value.ToString(CultureInfo.InvariantCulture)
                    });
            
                </text>
            }

        return data;
        }
    </script>
}
